var socks = require('../');

const useAuth = true;
const port = 2080;

const socksServer = socks.createServer({
  auths: useAuth ? 
  [socks.auth.UserPassword((username, password, cb) => {
    // console.log(username, password);
    // console.log(username == 'wxf' && password == 'wxf');
    cb(username == 'wxf' && password == 'wxf');
  }), socks.auth.None()]
  :
  [socks.auth.None()]

}).listen(port);

socksServer.on('listening', () => {
  console.log(`listening on port ${port}`);
});

socksServer.on('connection', (reqInfo, accept, deny) => {
  console.log(`${reqInfo.dstAddr}:${reqInfo.dstPort}`);
  accept();
})


// auths列表中的顺序代表验证偏好
// auths: [socks.auth.UserPassword('wxf', 'wxf'), socks.auth.None()]